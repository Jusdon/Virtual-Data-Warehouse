--
-- Satellite View definition for {{mainTable}}
-- Generated at {{generationDateTime}}
--

USE [{{metadataConfiguration.psaDatabaseName}}]
GO

{{#each individualSourceToTargetMapping}}

IF  EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[{{../metadataConfiguration.vedwSchemaName}}].[{{targetTable}}]') AND type in (N'V'))
DROP VIEW [{{../metadataConfiguration.vedwSchemaName}}].[{{targetTable}}]
GO

CREATE VIEW [{{../metadataConfiguration.vedwSchemaName}}].[{{targetTable}}] AS
SELECT 
    HASHBYTES('MD5',
    {{#each businessKey.businessKeyComponentMapping}}
      ISNULL(RTRIM(CONVERT(NVARCHAR(100), {{targetComponentName}})), 'N/A') + '#~!' {{#unless @last}}+{{/unless}}
    {{/each}}
    ) AS {{targetTableHashKey}},
    DATEADD(mcs,[{{../metadataConfiguration.sourceRowId}}], {{../metadataConfiguration.loadDateTimeAttribute}}) AS {{../metadataConfiguration.loadDateTimeAttribute}},
    {{#each columnMapping}}
    {{sourceColumn}} AS {{targetColumn}}{{#unless @last}},{{/unless}}
    {{/each}}
FROM {{sourceTable}}

{{/each}}